<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            text-align: center;
        }

        .parent {
            border: 1px solid black;
            margin: 1rem;
            padding: 2rem 2rem;
            text-align: center;
        }

        .child {
            display: inline-block;
            padding: 1rem 1rem;
            vertical-align: top;
            text-align: left;
        }

        .wordtable {
            border-collapse: collapse;
        }

        .wordtable td {
            /* border: .1em solid black; */
            /* border-radius: 8px; */
            text-align: center;
            padding: 10px;
        }

        .foundCell {
            border: .1em solid black;
        }

        .selectedTd {
            background-color: #f1f1f1;
        }

        .unselectedTd {
            background-color: white;
        }

        .selectedLi {
            font-weight: bold;
        }

        .unselectedLi {
            font-weight: normal;
        }

        .start {
            background-color: green;
            padding: 10px;
            width: 200px;
            color: white;
            font-size: large;
            text-align: center;
        }
    </style>
</head>

<body>
    <h1 id="title"></h1>

    <center><button onclick="findWords()" class="start">Start</button></center>
    <div class="parent">
        <div class="child">
            <table class="wordtable">
                <tbody id="tableBodyLetters"></tbody>
            </table>
        </div>
        <div class="child">
            <ul id="wordsUl"></ul>
        </div>
    </div>
    <script>

        let words;
        let rows;
        let flippedPositions = new Set();
        let cntr = 0;

        const sleep = ms => new Promise(r => setTimeout(r, ms));

        const buildLettersTable = (rows) => {
            const table = document.getElementById("tableBodyLetters");
            for (let r = 0; r < rows.length; r++) {
                const row = rows[r];
                const tableRow = table.insertRow(r);
                for (let i = 0; i < row.length; i++) {
                    const tableCell = tableRow.insertCell(i);
                    tableCell.id = `pos-${r}-${i}`;
                    tableCell.innerHTML = row[i];
                }
            }
        }

        const buildWordsTable = (words) => {
            const table = document.getElementById("tableBodyWords");
            const ul = document.getElementById("wordsUl");
            for (const word of words) {
                var li = document.createElement('li');
                li.id = `${word}-li`;
                li.innerHTML = word;
                ul.appendChild(li);
            }
        }

        const updateFoundCell = (pos, color) => {
            const cell = document.getElementById(pos);
            cell.style.color = color;
            cell.style.fontWeight = "bold";
            //cell.style.backgroundColor = "#f2f2f2";
            flippedPositions.add(pos);
            //cell.classList.add("foundCell");
        }



        const getLeftWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (colPos - (word.length - 1) >= 0) { // 7 - 8
                for (let p = colPos; p > colPos - word.length; p--) {
                    foundWord = foundWord + rows[rowPos][p];
                }
            }
            if (word === foundWord) {
                for (let p = colPos; p > colPos - word.length; p--) {
                    updateFoundCell(`pos-${rowPos}-${p}`, "green")
                }
            }
            return foundWord;
        }

        const getRightWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (colPos + word.length <= rows[0].length) {
                for (let p = colPos; p < colPos + word.length; p++) {
                    foundWord = foundWord + rows[rowPos][p];
                }
            }
            if (word === foundWord) {
                for (let p = colPos; p < colPos + word.length; p++) {
                    updateFoundCell(`pos-${rowPos}-${p}`, "blue");
                }
            }
            return foundWord
        }

        const getTopWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (rowPos - word.length >= 0) {
                for (let p = rowPos; p > rowPos - word.length; p--) {
                    foundWord = foundWord + rows[p][colPos];
                }
            }
            if (word === foundWord) {
                for (let p = rowPos; p > rowPos - word.length; p--) {
                    updateFoundCell(`pos-${p}-${colPos}`, "red")
                }
            }
            return foundWord;
        }

        const getBottomWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (rowPos + word.length <= rows.length) {
                for (let p = rowPos; p < rowPos + word.length; p++) {
                    foundWord = foundWord + rows[p][colPos];
                }
            }
            if (word === foundWord) {
                for (let p = rowPos; p < rowPos + word.length; p++) {
                    updateFoundCell(`pos-${p}-${colPos}`, "orange");
                }
            }
            return foundWord;
        }

        const getBottomRightWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (rowPos + word.length <= rows.length && colPos + word.length <= rows[0].length) {
                for (let i = 0; i < word.length; i++) {
                    foundWord = foundWord + rows[rowPos + i][colPos + i];
                }
            }
            if (word === foundWord) {
                for (let i = 0; i < word.length; i++) {
                    updateFoundCell(`pos-${rowPos + i}-${colPos + i}`, "purple");
                }
            }
            return foundWord;
        }

        const getBottomLeftWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (rowPos + word.length <= rows.length && colPos - word.length >= 0) {
                for (let i = 0; i < word.length; i++) {
                    foundWord = foundWord + rows[rowPos + i][colPos - i];
                }
            }
            if (word === foundWord) {
                for (let i = 0; i < word.length; i++) {
                    updateFoundCell(`pos-${rowPos + i}-${colPos - i}`, "pink");
                }
            }
            return foundWord;
        }

        const getTopRightWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (rowPos - word.length >= 0 && colPos + word.length <= rows[0].length) {
                for (let i = 0; i < word.length; i++) {
                    foundWord = foundWord + rows[rowPos - i][colPos + i];
                }
            }
            if (word === foundWord) {
                for (let i = 0; i < word.length; i++) {
                    updateFoundCell(`pos-${rowPos - i}-${colPos + i}`, "grey");
                }
            }
            return foundWord;
        }

        const getTopLeftWord = (word, rowPos, colPos) => {
            let foundWord = "";
            if (rowPos - word.length >= 0 && colPos - word.length >= 0) {
                for (let i = 0; i < word.length; i++) {
                    foundWord = foundWord + rows[rowPos - i][colPos - i];
                }
            }
            if (word === foundWord) {
                for (let i = 0; i < word.length; i++) {
                    updateFoundCell(`pos-${rowPos - i}-${colPos - i}`, "gold");
                }
            }
            return foundWord;
        }



        const findWord = async (rows, word) => {
            const firstLetter = word.split('')[0];
            firstloop:
            for (let rowPos = 0; rowPos < rows.length; rowPos++) {
                for (let colPos = 0; colPos < rows[rowPos].length; colPos++) {
                    const cell = document.getElementById(`pos-${rowPos}-${colPos}`);
                    cell.style.backgroundColor = '#f1f1f1';
                    const testLetter = rows[rowPos][colPos];
                    await sleep(5);
                    if (testLetter === firstLetter) {
                        const leftWord = getLeftWord(word, rowPos, colPos);
                        const rightWord = getRightWord(word, rowPos, colPos);
                        const topWord = getTopWord(word, rowPos, colPos);
                        const bottomWord = getBottomWord(word, rowPos, colPos);
                        const bottomRightWord = getBottomRightWord(word, rowPos, colPos);
                        const bottomLeftWord = getBottomLeftWord(word, rowPos, colPos);
                        const topRightWord = getTopRightWord(word, rowPos, colPos);
                        const topLeftWord = getTopLeftWord(word, rowPos, colPos);
                        if (leftWord === word || rightWord === word || topWord === word || bottomWord === word || bottomRightWord === word || bottomLeftWord === word || topRightWord === word || topLeftWord === word) {
                            console.log(word);
                            document.getElementById(`${word}-li`).style.textDecoration = "line-through";
                            cell.style.backgroundColor = "white"
                            break firstloop;
                        }
                    }
                    cell.style.backgroundColor = "white"
                }
            }

        }

        const dimOtherLetters = () => {
            for (let i = 0; i < rows.length; i++) {
                for (let j = 0; j < rows[0].length; j++) {
                    if (!flippedPositions.has(`pos-${i}-${j}`)) {
                        const cell = document.getElementById(`pos-${i}-${j}`);
                        cell.style.color = "#f1f1f1";
                    }
                }
            }
        }

        const findWords = async () => {
            for (const word of words) {
                document.getElementById(`${word}-li`).className = 'selectedLi';
                await findWord(rows, word);
                document.getElementById(`${word}-li`).className = 'unselectedLi';
            }
            dimOtherLetters();
        }

        const initialize = () => {
            let lettersDta = [
                "WIHBNXBSMSBUGYA",
                "ECDBUYMARKETING",
                "BRCTUAALREVENUE",
                "SNOITAREPOSELAS",
                "IORCDPBSSWHTSPV",
                "THCRAESERTEKRAM",
                "EWLMCQRXOVQDXAP",
                "WOPTNEMELBANEIA",
                "COMMUNICATIONSR",
                "TNETNOCUWWFGGPT",
                "KUMARKETINGOPSN",
                "QQUCMGNIDNARBFE",
                "FCREATIVEWJYXHR",
                "PUBLICRELATIONS",
                "RMJCDBCSSYOUEDR"
            ];
            // Convert the strings into arrays so you can reference each letter easily
            rows = [];
            lettersDta.forEach(rowString => {
                rows.push(rowString.split(''));
            });

            words = [
                "COMMUNICATIONS",
                "CREATIVE",
                "MARKETRESEARCH",
                "PUBLICRELATIONS",
                "MARKETINGOPS",
                "MARKETING",
                "SALESOPERATIONS",
                "BRANDING",
                "CRO",
                "PARTNERS",
                "REVENUE",
                "ENABLEMENT",
                "CONTENT",
                "WEBSITE",
                "BDR",
                "SALESEXECUTIVES"
            ]

            // words = [
            //     "CREATIVE", "MARKETRESEARCH", "SALESEXECUTIVES", "BIGP", "BDR", "BUARS"
            // ]
            buildWordsTable(words);
            words.sort((a, b) => b.length - a.length)
        }

        initialize();

        document.getElementById("title").innerHTML = "Wordsearch Example"; ``
        buildLettersTable(rows);

    </script>
</body>

</html>